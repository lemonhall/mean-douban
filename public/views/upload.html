<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/cloudinary/js/jquery.ui.widget.js"></script>
<script type="text/javascript" src="../lib/cloudinary/js/jquery.iframe-transport.js"></script>
<script type="text/javascript" src="../lib/cloudinary/js/jquery.fileupload.js"></script>
<script type="text/javascript" src="../lib/cloudinary/js/jquery.cloudinary.js"></script>

<div id="direct_upload">
  <h1>New Photo</h1>
  <h2>Direct upload from the browser</h2>
  <p>You can also drag and drop an image file into the dashed area.</p>
    <div class="form_line">
      <div class="form_controls">
        
      </div>
    </div>
    <div class="form_line">
      <div class="form_controls">
        <div class="upload_button_holder">
          <a href="#" value="Upload" class="upload_button">
		<input name="file" type="file" 
   			class="cloudinary-fileupload" data-cloudinary-field="image_id" 
   			data-form-data=" ... html-escaped JSON data ... " ></input>
        </div>
        <span class="status"></span>
      </div>
    </div>
    <div class="form_line">
      <div class="form_controls">
        <div class="preview"></div>
      </div>
    </div>
    <div class="form_line">
      <div class="form_controls">
      	<input type="submit" value="Submit Photo">
      </div>
    </div>
    <input type="hidden" id="photo_bytes">
</div>

<a href="" class="back_link">Back to list</a>

<div id="info"></div>





<script type="text/javascript">

$(document).ready(function(){


	$.cloudinary.config({ cloud_name: 'dlfu5hzg3', api_key: '232118153483713'});

	// Cloudinary jQuery integration library uses jQuery File Upload widget
    // (see http://blueimp.github.io/jQuery-File-Upload/).
    // Any file input field with cloudinary-fileupload class is automatically
    // wrapped using the File Upload widget and configured for Cloudinary uploads.
    // You can further customize the configuration using .fileupload method
    // as we do below.
    $(".cloudinary-fileupload")
      .fileupload({ 
        // Uncomment the following lines to enable client side image resizing and valiation.
        // Make sure cloudinary/processing is included the js file
        //disableImageResize: false,
        //imageMaxWidth: 800,
        //imageMaxHeight: 600,
        //acceptFileTypes: /(\.|\/)(gif|jpe?g|png|bmp|ico)$/i,
        //maxFileSize: 20000000, // 20MB
        dropZone: "#direct_upload",
        start: function (e) {
          $(".status").text("Starting upload...");
        },
        progress: function (e, data) {
          $(".status").text("Uploading... " + Math.round((data.loaded * 100.0) / data.total) + "%");
        },
        fail: function (e, data) {
          $(".status").text("Upload failed");
        }
      })
      .off("cloudinarydone").on("cloudinarydone", function (e, data) {
        $("#photo_bytes").val(data.result.bytes);
        $(".status").text("");
        $(".preview").html(
          $.cloudinary.image(data.result.public_id, {
            format: data.result.format, width: 50, height: 50, crop: "fit"
          })
        );
        view_upload_details(data.result);
     });//End of $(".cloudinary-fileupload")
    
    function view_upload_details(upload) {
      // Build an html table out of the upload object
      var rows = [];
      $.each(upload, function(k,v){
        rows.push(
          $("<tr>")
            .append($("<td>").text(k))
            .append($("<td>").text(JSON.stringify(v))));
      });
      $("#info").html(
        $("<div class=\"upload_details\">")
          .append("<h2>Upload metadata:</h2>")
          .append($("<table>").append(rows)));
    }  
});
</script>

